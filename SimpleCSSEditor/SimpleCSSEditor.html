<html>

<head>

<style>

html {
	font-family: verdana;
}

 table { 
    border-collapse: collapse; 
    margin: 0px 0px 0px 0px;
    }

/* Zebra striping */
/*
tr:nth-of-type(even) { 
    background: #bfbfbf; 
    }
tr:nth-of-type(odd) { 
    background: #eeeeee; 
    }

*/

/* Zebra striping */
.tileTR:nth-of-type(even), .tileTRAlt:nth-of-type(odd) { 
    background: #bfbfbf; 
    }
	
.tileTR:nth-of-type(odd), .tileTRAlt:nth-of-type(even) { 
    background: #eeeeee; 
    }
	
	


th { 
    background: rgba(39, 109, 140,0.50); 
    color: white; 
    }
td, th { 
    padding: 10px;
    border: 0px; 
    text-align: left; 
    }

td {
	font-size: 12px;
}

.tileContent {
	display: block;
	padding-bottom: 10px;
	width: 700px;
}

.dashboardHeading, .tileHeading {
	font-weight: normal;
	font-size: 14px;
	color: white;
	background-color: transparent;
	border: none;
	padding-left: 5px;
	margin: 0px;
	text-align: left;
	outline: none;
}

.templateName {
	font-style: italic;
	font-weight: normal;
	font-size: 10px;
	color: white;
}



.collapsible {
  background-color: transparent;
  border: none;
  padding: 0px;
  margin: 0px;
  text-align: left;
  outline: none;
  font-size: 12px;
}

.collapsible:after {
  content: '\02795'; /* Unicode character for "plus" sign (+) */
  font-size: 10px;
  float: right;
  margin-left: 5px;
}


.active:after {
  content: "\2796"; /* Unicode character for "minus" sign (-) */
  font-size: 10px;
}

/* Style the collapsible content. Note: hidden by default */
.borderContent, .textContent, .tileContent, .iconsContent {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease-out;
}	


</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script>

function hexToRgb(hex) {
    var bigint = parseInt(hex, 16);
    var r = (bigint >> 16) & 255;
    var g = (bigint >> 8) & 255;
    var b = bigint & 255;

    return r + "," + g + "," + b;
}

function componentToHex(c) {
  var hex = c.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

function rgbToHex(r, g, b) {
  return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}

function getDashName() {

  return window.parent.document.getElementsByClassName("dashName")[0].innerHTML.trim().replace(" ","_");
}

function dashHeaderClick(radio) {
	if(radio.value == 'Normal') {
		document.getElementById('hideDashBack').disabled = false;
		document.getElementById('hideDashTitle').disabled = false;
	}
	else
	{
		document.getElementById('hideDashBack').disabled = true;
		document.getElementById('hideDashTitle').disabled = true;
	}
}

function readInSettings() {
		var dashName = getDashName();
		
			$.ajax({
			  dataType: "json",
			  url: "http://" + location.hostname + "/local/" + dashName + ".json",
			  success: function (data) { 

				  
				  $.each( data, function( key, val ) {
				  
					if(key == "tiles") {
						
						for (var tile in data.tiles) {
							var tileId = data.tiles[tile].id;
							var tileEl = window.parent.document.getElementById(tileId);
							if (tileEl != null) {
								document.getElementById(tileId + "_name").value = data.tiles[tile].name;
								document.getElementById(tileId + "_group").value = data.tiles[tile].group;
								document.getElementById(tileId + "_notes").value = data.tiles[tile].notes;
								document.getElementById(tileId + "_exportCSS").checked = data.tiles[tile].exportCSS;
								document.getElementById(tileId + "_CSSTemplate").value = data.tiles[tile].cssTemplate;
								document.getElementById(tileId + "_hideTitle").checked = data.tiles[tile].hideTitle;
								document.getElementById(tileId + "_radius").value = data.tiles[tile].borderRadius;
								
								// Borders
								
								$.each( data.tiles[tile].borders, function( borderKey, borderVal ) {
										var borderCheckbox = document.getElementById(tileId + "_border" + borderKey);
										borderCheckbox.checked = true;
										expandSetting(borderCheckbox, tileId, 'border_' + borderKey, 'no');
										$.each( borderVal, function( borderPosKey, borderPosVal ) {
											var element = document.getElementById(tileId + '_border' + borderKey + borderPosKey.charAt(0).toUpperCase() + borderPosKey.slice(1));
											if(element.type == 'checkbox') { element.checked = borderPosVal; }
											else { element.value = borderPosVal; }
									});
								});
								
								// Text
								$.each( data.tiles[tile].text, function( textKey, textVal ) {
										var textCheckbox = document.getElementById(tileId + "_text" + textKey);
										textCheckbox.checked = true;
										expandSetting(textCheckbox, tileId, 'text_' + textKey, 'no');
										
										$.each( textVal, function( textPosKey, textPosVal ) {
											var element = document.getElementById(tileId + '_text' + textKey + textPosKey.charAt(0).toUpperCase() + textPosKey.slice(1));
											if (element != null) {
												if (element.type == 'checkbox' || element.type == 'radio') { element.checked = textPosVal; }
												else { element.value = textPosVal; }
											}
									});
								});
								
								
								// Icons
								$.each( data.tiles[tile].icons, function( iconKey, iconVal ) {
										var element = document.getElementById(tileId + '_icons' + iconKey.charAt(0).toUpperCase() + iconKey.slice(1));
										if (element != null) {
											if (element.type == 'checkbox' || element.type == 'radio') { element.checked = iconVal; }
											else { element.value = iconVal; }
										}
								});
								
								
								document.getElementById(tileId + "_z-index").value = data.tiles[tile].zIndex;
								const bgColorRgba = data.tiles[tile].bgColor.split(",");
								document.getElementById(tileId + "_bg-color").value = rgbToHex(parseInt(bgColorRgba[0]), parseInt(bgColorRgba[1]), parseInt(bgColorRgba[2]));
								document.getElementById(tileId + "_bg-alpha").value = bgColorRgba[3];
							}
						}

					}
					
					if(key == "dashboard") {
					
						$.each( val, function( dashKey, dashVal ) {
						
							if( dashKey == 'dashHeader' ) { document.getElementById('dashHeader' + dashVal).checked = true }
							
							if ((dashKey == 'hideDashBack'
							 || dashKey == 'hideDashTitle')
							&&	dashVal == true )		  { document.getElementById(dashKey).checked = true }
						})
					}
				  });
			  }
			}).fail(function(jqXHR, textStatus, errorThrown) {
						console.error(jqXHR, textStatus, errorThrown);
						console.error(jqXHR.responseJSON);
						if (errorThrown == 'Not Found') { alert("Warning: The CSS Settings JSON file was not found"); }
						else { alert("Error reading CSS Settings JSON File: " + errorThrown); }
					});	
		
	} // end of readInSettings()
	

function createDashboardInputs() {

	var tableHTML = '';
	
	tableHTML += '<table id="dashboardSettings" >\n';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 500px;"/>\n';
	
	
	
	tableHTML += '<thead>';
	tableHTML += '<tr>';
	tableHTML += '<th colspan="2"><span class="dashboardHeading">Dashboard</span></th>';
	tableHTML += '</tr>';
	tableHTML += '</thead>';

	tableHTML += '<tbody>';
	tableHTML += '<tr class="tileTR">';
	tableHTML += '<td style="vertical-align: top;">Dashboard Header and Controls</td>';
	
	tableHTML += '<td>';
	tableHTML += '<input type="radio" id="dashHeaderNormal" name="dashHeader" onclick="dashHeaderClick(this);" value="Normal">';
	tableHTML += '<label for="dashHeaderNormal">Normal Display</label><br/>';
	
	tableHTML += '<input type="checkbox" id="hideDashBack" style="margin-left: 40px"/>';
	tableHTML += '<label for="hideDashBack">Hide Back (Hubitat) Icon?</label><br/>';
	tableHTML += '<input type="checkbox" id="hideDashTitle" style="margin-left: 40px"/>';
	tableHTML += '<label for="hideDashTitle">	Hide Title?</label><br/>';
	
	tableHTML += '<input type="radio" id="dashHeaderHidden" name="dashHeader" onclick="dashHeaderClick(this);" value="Hidden">';
	tableHTML += '<label for="dashHeaderHidden">Hidden</label><br/>';
	tableHTML += '<input type="radio" id="dashHeaderTopRight" name="dashHeader" onclick="dashHeaderClick(this);" value="TopRight">';
	tableHTML += '<label for="dashHeaderTopRight">Top Right</label><br/>';
	tableHTML += '<input type="radio" id="dashHeaderBottomRight" name="dashHeader" onclick="dashHeaderClick(this);" value="BottomRight">';
	tableHTML += '<label for="dashHeaderBottomRight">Bottom Right</label><br/>';
	tableHTML += '<input type="radio" id="dashHeaderTopLeft" name="dashHeader" onclick="dashHeaderClick(this);" value="TopLeft">';
	tableHTML += '<label for="dashHeaderTopLeft">Top Left</label><br/>';
	tableHTML += '<input type="radio" id="dashHeaderBottomLeft" name="dashHeader" onclick="dashHeaderClick(this);" value="BottomLeft">';
	tableHTML += '<label for="dashHeaderBottomLeft">Bottom Left</label><br/>';
	tableHTML += '</td>';
	
	tableHTML += '</tr>';
	tableHTML += '</tbody>';
	tableHTML += '</table>\n';
	return tableHTML;
}

function createIconsControlsInputs(tileId) {
	
	var tableHTML = '';
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top;"><input id="' + tileId + '_iconsIconHide" type="checkbox" />\n';
	tableHTML += '	<label for="' + tileId + '_iconsIconHide">Hide Icon</label></td>\n';
	tableHTML += '	<td></td>\n';
	tableHTML += '	</tr>\n';

	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top;"><input id="' + tileId + '_iconsDimmerHide" type="checkbox" />\n';
	tableHTML += '	<label for="' + tileId + '_iconsDimmerHide">Hide Slider / Dimmer</label></td>\n';
	tableHTML += '	<td></td>\n';
	tableHTML += '	</tr>\n';
	
	return tableHTML;
}

function createBorderPosInputs(tileId, borderPos) {

	var tableHTML = '';
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td><input id="' + tileId + '_border' + borderPos + '" type="checkbox" onclick="expandSetting(this, \'' + tileId + '\', \'border_' + borderPos + '\', \'no\')"/>\n';
	tableHTML += '	<label for="' + tileId + '_border' + borderPos + '">' + borderPos + '</label></td>\n';
	tableHTML += '	<td></td>\n';
	tableHTML += '	</tr>\n';
	
	tableHTML += '<tr>';
	tableHTML += '<td colspan="2"  style="padding: 0px;">';
	
	tableHTML += '<div id="' + tileId + '_border_' + borderPos + 'Content" class="textContent" >\n';
	tableHTML += '<table>\n';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 300px;"/>\n';
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; text-align: right; "><label for="' + tileId + '_border' + borderPos + 'Thick">Thickness:</label></td>\n';
	tableHTML += '	<td><select name="' + tileId + '_border' + borderPos + 'Thick" id="' + tileId + '_border' + borderPos + 'Thick">\n';
	tableHTML += '		<option value=""></option>\n';
	tableHTML += '		<option value="thin">Thin</option>\n';
	tableHTML += '		<option value="medium">Medium</option>\n';
	tableHTML += '		<option value="thick">Thick</option>\n';
	tableHTML += '		<option value="other">Other</option>\n';
	tableHTML += '	</select>\n';
	tableHTML += '	<input id="' + tileId + '_border' + borderPos + 'ThickOth" type="number" min="0" max="10"/> pixels</td>\n';
	tableHTML += '	</tr>\n';
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; text-align: right; "><label for="' + tileId + '_border' + borderPos + 'Style">Style:</label></td>\n';
	tableHTML += '	<td><select name="' + tileId + '_border' + borderPos + 'Style" id="' + tileId + '_border' + borderPos + 'Style">\n';
	tableHTML += '		<option value=""></option>\n';
	tableHTML += '		<option value="none">None</option>\n';
	tableHTML += '		<option value="dotted">Dotted</option>\n';
	tableHTML += '		<option value="dashed">Dashed</option>\n';
	tableHTML += '		<option value="solid">Solid</option>\n';
	tableHTML += '		<option value="double">Double</option>\n';
	tableHTML += '	</select></td>\n';
	tableHTML += '	</tr>\n';
	
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; text-align: right; "><label for="' + tileId + '_border' + borderPos + 'Color">Color:</label></td>\n';
	tableHTML += '  <td><input id="' + tileId + '_border' + borderPos + 'Color" type="color"/> Transparency: <input id="' + tileId + '_border' + borderPos + 'ColorAlpha" type="number" min="0" max="1" step="0.1" value="1" /></td>\n';
	tableHTML += '	</tr>\n';
	
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';
	tableHTML += '	</table>\n';
	tableHTML += '</div>';
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';
	
	return tableHTML;
}


// /html/body/div/div/div/div[2]/div[7]/div[1]/div

//document.querySelector("#tile-7 > div.flex.flex-col.w-full.text-center.h-full > div")

function createTileTextPosInputs(tileId, textPos) {

	var contentsVal = '';
	var contentsEl;
	var tileEl = window.parent.document.getElementById(tileId);
	if (tileEl != null) {
		if (textPos != 'TextTile') { contentsEls = tileEl.getElementsByClassName("tile-" + textPos.toLowerCase()); }
		else { contentsEls = tileEl.getElementsByTagName("div")[0].getElementsByTagName("div"); }
		if(contentsEls && contentsEls.length > 0) { contentsVal = contentsEls[0].textContent; }
	}
	contentsVal = (contentsVal == null || contentsVal == '') ? '<i>Blank</i>' : contentsVal;
	
	var tableHTML = '';
	
	tableHTML += '<tr class="tileTR">';
	tableHTML += '<td><input id="' + tileId + '_text' + textPos + '" onclick="expandSetting(this, \'' + tileId + '\', \'text_' + textPos + '\', \'no\')" type="checkbox"/>';
	tableHTML += '<label for="' + tileId + '_text' + textPos + '">' + textPos + '</label></td>';	
	tableHTML += '<td>' + contentsVal + '</td>';
	tableHTML += '</tr>';
	
	tableHTML += '<tr class="tileTRAlt">';
	tableHTML += '<td colspan="2"  style="padding: 0px;">';
	
	tableHTML += '<div id="' + tileId + '_text_' + textPos + 'Content" class="textContent" >\n';
	tableHTML += '<table>\n';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 300px;"/>\n';
	
	tableHTML += '<tr>';
	tableHTML += '<td style="vertical-align: top; padding-left: 30px;"><input type="radio" id="' + tileId + '_text' + textPos + 'Default" name="' + tileId + '_text' + textPos + 'Option" value="Default" checked="checked">\n';
	tableHTML += '<label for="' + tileId + '_text' + textPos + 'Default">Default</label>\n';
	tableHTML += '</td>\n';
	tableHTML += '<td></td>\n';
	tableHTML += '</tr>\n';
	
	tableHTML += '<tr>';
	tableHTML += '<td style="vertical-align: top; padding-left: 30px;"><input type="radio" id="' + tileId + '_text' + textPos + 'Hide" name="' + tileId + '_text' + textPos + 'Option" value="Hide">\n';
	tableHTML += '<label for="' + tileId + '_text' + textPos + 'Hide">Hide</label>\n';
	tableHTML += '</td>\n';
	tableHTML += '<td></td>\n';
	tableHTML += '</tr>\n';
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; padding-left: 30px;"><input type="radio" id="' + tileId + '_text' + textPos + 'Replace" name="' + tileId + '_text' + textPos + 'Option" value="Replace">\n';
	tableHTML += '	<label for="' + tileId + '_text' + textPos + 'Replace">Replace:</label>\n';
	tableHTML += '	</td>\n';
	tableHTML += '	<td>\n';
	tableHTML += '  <input id="' + tileId + '_text' + textPos + 'ReplaceText" type="text" />\n';
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; padding-left: 30px;"><input type="radio" id="' + tileId + '_text' + textPos + 'AddTo" name="' + tileId + '_text' + textPos + 'Option" value="AddTo">\n';
	tableHTML += '	<label for="' + tileId + '_text' + textPos + 'AddTo">Add Text:</label>\n';
	tableHTML += '	</td>\n';
	tableHTML += '	<td>\n';
	tableHTML += '	<label for="' + tileId + '_text' + textPos + 'BeforeText">Before:</label>';
	tableHTML += '  <input id="' + tileId + '_text' + textPos + 'BeforeText" type="text" /><br/>\n';
	tableHTML += '	<label for="' + tileId + '_text' + textPos + 'AfterText">After:</label>';
	tableHTML += '  <input id="' + tileId + '_text' + textPos + 'AfterText" type="text" /><br/>\n';
	
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';
	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; text-align: left; padding-left: 30px;"><input id="' + tileId + '_text' + textPos + 'FontFamily" type="checkbox" /><label for="' + tileId + '_text' + textPos + 'FontFamily">Font Family:</label></td>\n';
	tableHTML += '	<td><select name="' + tileId + '_text' + textPos + 'FontFamilyVal" id="' + tileId + '_text' + textPos + 'FontFamilyVal">\n';
	tableHTML += '		<option value=""></option>\n';
	tableHTML += '		<option value="Arial" style="font-family: Arial;">Arial</option>\n';
	tableHTML += '		<option value="Arial Black" style="font-family: \'Arial Black\';">Arial Black</option>\n';
	tableHTML += '		<option value="Verdana" style="font-family: Verdana;">Verdana</option>\n';
	tableHTML += '		<option value="Tahoma" style="font-family: Tahoma;">Tahoma</option>\n';
	tableHTML += '		<option value="Trebuchet MS" style="font-family: \'Trebuchet MS\';">Trebuchet MS</option>\n';
	tableHTML += '		<option value="Impact" style="font-family: Impact;">Impact</option>\n';
	tableHTML += '		<option value="Times New Roman" style="font-family: \'Times New Roman\';">Times New Roman</option>\n';
	tableHTML += '		<option value="Didot" style="font-family: Didot;">Didot</option>\n';
	tableHTML += '		<option value="Georgia" style="font-family: Georgia;">Georgia</option>\n';
	tableHTML += '		<option value="American Typewriter" style="font-family: \'American Typewriter\';">American Typewriter</option>\n';
	tableHTML += '		<option value="Andalé Mono" style="font-family: \'Andalé Mono\';">Andalé Mono</option>\n';
	tableHTML += '		<option value="Courier" style="font-family: Courier;">Courier</option>\n';
	tableHTML += '		<option value="Lucida Console" style="font-family: \'Lucida Console\';">Lucida Console</option>\n';
	tableHTML += '		<option value="Monaco" style="font-family: Monaco;">Monaco</option>\n';
	tableHTML += '		<option value="Bradley Hand" style="font-family: \'Bradley Hand\';">Bradley Hand</option>\n';
	tableHTML += '		<option value="Brush Script MT" style="font-family: \'Brush Script MT\';">Brush Script MT</option>\n';
	tableHTML += '		<option value="Luminari" style="font-family: Luminari;">Luminari</option>\n';
	tableHTML += '		<option value="Comic Sans MS" style="font-family: \'Comic Sans MS\';">Comic Sans MS</option>\n';
	tableHTML += '		<option value="Other">Other...</option>\n';
	tableHTML += '	</select><br/>';
	tableHTML += '  <input id="' + tileId + '_text' + textPos + 'FontFamilyOther" type="text" />\n';
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';



	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; padding-left: 30px;">Font Style: </td>\n';
	tableHTML += '	<td>';
	tableHTML += '	<input id="' + tileId + '_text' + textPos + 'FontBold" type="checkbox" /><label for="' + tileId + '_text' + textPos + 'FontBold">Bold</label><br/>';
	tableHTML += '	<input id="' + tileId + '_text' + textPos + 'FontItalic" type="checkbox" /><label for="' + tileId + '_text' + textPos + 'FontItalic">Italic</label><br/>';
	tableHTML += '	<input id="' + tileId + '_text' + textPos + 'FontUnderline" type="checkbox" /><label for="' + tileId + '_text' + textPos + 'FontUnderline">Underline</label>';
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';

	
	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; padding-left: 30px;"><input id="' + tileId + '_text' + textPos + 'FontSize" type="checkbox" />\n';
	tableHTML += '	<label for="' + tileId + '_text' + textPos + 'FontSize">Font Size: </label></td>\n';
	tableHTML += '	<td><input id="' + tileId + '_text' + textPos + 'FontSizeVal" type="number" min="0" max="50" step="1" /> px</td>\n';
	tableHTML += '	</tr>\n';

	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; text-align: left; padding-left: 30px;"><input id="' + tileId + '_text' + textPos + 'FontColor" type="checkbox" /><label for="' + tileId + '_text' + textPos + 'FontColor">Font Color:</label></td>\n';
	tableHTML += '  <td><input id="' + tileId + '_text' + textPos + 'FontColorVal" type="color"/> Transparency: <input id="' + tileId + '_text' + textPos + 'FontColorAlpha" type="number" min="0" max="1" step="0.1" value="1" /></td>\n';
	tableHTML += '	</tr>\n';

	// Text Alignment Setting

	tableHTML += '	<tr>\n';
	tableHTML += '	<td style="vertical-align: top; text-align: left; padding-left: 30px;"><input id="' + tileId + '_text' + textPos + 'Align" type="checkbox" /><label for="' + tileId + '_text' + textPos + 'Align">Alignment:</label></td>\n';
	tableHTML += '	<td><select name="' + tileId + '_text' + textPos + 'AlignVal" id="' + tileId + '_text' + textPos + 'AlignVal">\n';
	tableHTML += '		<option value=""></option>\n';
	tableHTML += '		<option value="Left" >Left</option>\n';
	tableHTML += '		<option value="Center" >Center</option>\n';
	tableHTML += '		<option value="Right" >Right</option>\n';
	tableHTML += '	</select><br/>';
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';

	
	tableHTML += '	</table>\n';
	tableHTML += '</div>';
	tableHTML += '	</td>\n';
	tableHTML += '	</tr>\n';
		
	return tableHTML;
}

function createTileInputs(tileId) {
	
	var tileTemplate = window.parent.document.getElementById(tileId).className.split(" ")[1];
	tileTemplate = tileTemplate[0].toUpperCase() + tileTemplate.slice(1);
		
	var tableHTML = '';
	
	tableHTML += '<table>\n';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 500px;"/>\n';
	tableHTML += '<thead>\n';
	tableHTML += '<th onClick="expandSetting(this,\'' + tileId + '\',\'tile\', \'no\')">\n';
	tableHTML += '<input id="' + tileId + '_exportCSS" type="checkbox"/><button type="button" class="tileHeading" onClick="expandSetting(this,\'' + tileId + '\',\'tile\', \'no\')"><span>' + tileId + '</span></button><br/>\n';
	tableHTML += '<span class="templateName" style="padding-left: 24px">' + tileTemplate + '</span>\n';
	tableHTML += '</th><th style="text-align:right;"><select id="' + tileId + '_CSSTemplate" /></th>\n';
	tableHTML += '</thead>\n';
	tableHTML += '</table>\n';
	
	tableHTML += '<div id="' + tileId + '_tileContent" class="tileContent">\n';
	tableHTML += '<table>\n';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 500px;"/>\n';
	tableHTML += '<tbody >\n';
	tableHTML += '<tr class="tileTR">\n';
	tableHTML += '<td>Hide Title?</td>\n';
	tableHTML += '<td><input id="' + tileId + '_hideTitle" type="checkbox"/></td>\n';
	tableHTML += '</tr>\n';
	
	tableHTML += '<tr class="tileTR">\n';
	tableHTML += '<td>Order (Z-Index)</td>\n';
	tableHTML += '<td><input id="' + tileId + '_z-index" type="number" min="0" max="999"/></td>\n';
	tableHTML += '</tr>\n';
	
	tableHTML += '<tr class="tileTR">\n';
	tableHTML += '<td style="padding-right: 10px">Background</td>\n';
	tableHTML += '<td><input id="' + tileId + '_bg-color" type="color"/> Transparency: <input id="' + tileId + '_bg-alpha" type="number" min="0" max="1" step="0.1" value="1" /></td>\n';
	tableHTML += '</tr>\n';
	
	
	// Borders
	
	tableHTML += '<tr class="tileTR">\n';
	
	tableHTML += '<td onClick="expandSetting(document.getElementById(\'' + tileId + '_bordersButton\'),\'' + tileId + '\',\'border\', \'yes\')" style="vertical-align: top;">\n';
	tableHTML += '<button id="' + tileId + '_bordersButton" type="button" class="collapsible" >Borders</button>\n';
	tableHTML += '</td>\n';
	
	tableHTML += '<td>\n';
	tableHTML += '<div id="' + tileId + '_borderContent" class="borderContent">\n';
	tableHTML += '	<label for="' + tileId + '_radius">Rounding: </label>\n';
	tableHTML += '	<input id="' + tileId + '_radius" type="number" min="0" max="30"/> pixels<br/><br/>\n';
	
	tableHTML += '	<table>\n';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 300px;"/>\n';
	tableHTML += createBorderPosInputs(tileId, 'All');
	tableHTML += createBorderPosInputs(tileId, 'Left');
	tableHTML += createBorderPosInputs(tileId, 'Right');
	tableHTML += createBorderPosInputs(tileId, 'Top');
	tableHTML += createBorderPosInputs(tileId, 'Bottom');
	tableHTML += '	</table>\n';
	tableHTML += '</div>\n';
	tableHTML += '</td>\n';
	tableHTML += '</tr>\n';
	
	// End of Borders
	
	// Text
	tableHTML += '<tr class="tileTR">';
	tableHTML += '<td onClick="expandSetting(document.getElementById(\'' + tileId + '_textButton\'),\'' + tileId + '\',\'text\', \'yes\')" style="vertical-align: top;">';
	
	tableHTML += '<button id="' + tileId + '_textButton" type="button" class="collapsible" onClick="expandSetting(this,\'' + tileId + '\',\'text\', \'yes\')">Text</button></td>';
	
	tableHTML += '<td style="padding: 0px;">';
	tableHTML += '<div id="' + tileId + '_textContent" class="textContent">';
	
	tableHTML += '<table>';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 300px;"/>\n';
	tableHTML += createTileTextPosInputs(tileId, 'Title');
	tableHTML += createTileTextPosInputs(tileId, 'Primary');
	tableHTML += createTileTextPosInputs(tileId, 'Secondary');
	tableHTML += createTileTextPosInputs(tileId, 'Tertiary');
	tableHTML += createTileTextPosInputs(tileId, 'TextTile');
	tableHTML += '</table>';
	tableHTML += '</div>\n';
	tableHTML += '</td>\n';
	tableHTML += '</tr>\n';
	
	// End of Text

	// Icons and Controls
	tableHTML += '<tr class="tileTR">';
	tableHTML += '<td onClick="expandSetting(document.getElementById(\'' + tileId + '_iconsButton\'),\'' + tileId + '\',\'icons\', \'yes\')" style="vertical-align: top;">';
	
	tableHTML += '<button id="' + tileId + '_iconsButton" type="button" class="collapsible" onClick="expandSetting(this,\'' + tileId + '\',\'icons\', \'yes\')">Icons and Controls</button></td>';
	
	tableHTML += '<td style="padding: 0px;">';
	tableHTML += '<div id="' + tileId + '_iconsContent" class="iconsContent">';
	
	tableHTML += '<table>';
	tableHTML += '<col style="width: 200px;"/>\n';
	tableHTML += '<col style="width: 300px;"/>\n';
	
	tableHTML += createIconsControlsInputs(tileId);	
	
	tableHTML += '</table>';
	tableHTML += '</div>\n';
	tableHTML += '</td>\n';
	tableHTML += '</tr>\n';
	
	// End of Icons and Controls	
	
	tableHTML += '<tr class="tileTR">';
	tableHTML += '<td>Name</td>';
	tableHTML += '<td><input id="' + tileId + '_name" type="text" /></td>';
	tableHTML += '</tr>';
		
	tableHTML += '<tr class="tileTR">\n';
	tableHTML += '<td>Group</td>\n';
	tableHTML += '<td><input id="' + tileId + '_group" type="text" /></td>\n';
	tableHTML += '</tr>\n';
	
	tableHTML += '<tr class="tileTR">\n';
	tableHTML += '<td style="vertical-align: top;">Notes</td>\n';
	tableHTML += '<td><textarea id="' + tileId + '_notes" cols="25" rows="6" maxlength="255" style="width: 100%; max-width: 100%;" /></textarea></td>\n';
	tableHTML += '</tr>\n';
	
	tableHTML += '</tbody>\n';
	tableHTML += '</table>\n';
	tableHTML += '</div>\n'; // End of Tile Content div
	return tableHTML;
}

$(document).ready(function () {
	
	var dashboardSettings = document.getElementById("dashboardSettings-div");
	var tileListOptions = '<option value="" >Copy CSS Template...</option>\n';
	var settingsHTML = '';
	settingsHTML += createDashboardInputs();
	var x = window.parent.document.getElementsByClassName("tile");
	
	var i;
	// For Each Tile in the dashboard
	// Build up the input and other elements
	for (i = 0; i < x.length; i++) {
		settingsHTML += createTileInputs(x[i].id);
		tileListOptions += '<option value="' + x[i].id + '" >' + x[i].id + '</option>\n';
	}
	// Add the Tile and Dashboard Settings to the settings DIV
	dashboardSettings.innerHTML += settingsHTML;
	
	// Go back over 
	for (i = 0; i < x.length; i++) {
		var tileCSSTemplates = document.getElementById(x[i].id + '_CSSTemplate');
		tileCSSTemplates.innerHTML += tileListOptions;
	}
	
	readInSettings();
	
});
</script>
</head>
<body>
	<div class="container">
		
	
		<div id="dashboardSettings-div" class="form-control" style="width: 700px; margin-left: auto; margin-right: auto;">
			<button onClick="writeCSS();">Save Settings & Export CSS</button><br/><br/>
		</div>
	</div>
	
</body>



<script>


function getTileBorderCSS(tileId, srcTileId, borderPos) {
	var thickEl		= document.getElementById(srcTileId + '_border' + borderPos + 'Thick');
	var thickOthEl	= document.getElementById(srcTileId + '_border' + borderPos + 'ThickOth');
	var thickVal = thickEl.value;
	var thickOthVal = thickOthEl.value;
	if(thickVal != '' && thickVal != 'other') { thickOthVal = ''; }
	else { if (thickOthVal != '') {
			thickVal = '';
			thickOthVal = thickOthVal + 'px'; }
	}
	var style		= document.getElementById(srcTileId + '_border' + borderPos + 'Style');
	var color		= document.getElementById(srcTileId + '_border' + borderPos + 'Color');
	
	var colorAlpha	= document.getElementById(srcTileId + '_border' + borderPos + 'ColorAlpha');
	colorString = 'rgba(' + hexToRgb(color.value.replace("#","")) + ',' + colorAlpha.value + ')';
	var borderPosStr = '';
	if (borderPos == 'All') { borderPosStr = 'border'; }
	else { borderPosStr = 'border-' + borderPos.toLowerCase(); }
	//#tile-97 { border-bottom: 3px solid gray;
	return '	#' + tileId + ' { ' + borderPosStr + ': ' + thickVal + thickOthVal + ' ' + style.value + ' ' + colorString + '; }\n'
	
}

function getTileTextCSS(tileId, srcTileId, textPos) {

	var textCSS = '';
	
	if (textPos != 'TextTile') {
		var hide		= document.getElementById(srcTileId + '_text' + textPos + 'Hide').checked;
		var replace		= document.getElementById(srcTileId + '_text' + textPos + 'Replace').checked;
		var addTo 		= document.getElementById(srcTileId + '_text' + textPos + 'AddTo').checked;
		if(hide) {
			textCSS += '	#' + tileId + ' .tile-' + textPos.toLowerCase() + ' { ';
			textCSS += 'display: none; visibility: hidden; ';
			textCSS += '}\n';
		}
		else
		{
			if(replace) {
				var replaceText		= document.getElementById(srcTileId + '_text' + textPos + 'ReplaceText').value;
				textCSS += '	#' + tileId + ' .tile-' + textPos.toLowerCase() + ' { ';
				textCSS += 'visibility: hidden; ';
				textCSS += '}\n';
				textCSS += '	#' + tileId + ' .tile-' + textPos.toLowerCase() + ':after { visibility: visible !important; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); overflow: hidden; white-space: nowrap !important; content: "' + replaceText + '" !important; }\n';
				
			}
			else
			{
				if(addTo) {
					var before	= document.getElementById(srcTileId + '_text' + textPos + 'BeforeText').value;
					var after	= document.getElementById(srcTileId + '_text' + textPos + 'AfterText').value;
					if(before != '') { textCSS += '	#' + tileId + ' .tile-' + textPos.toLowerCase() + ':before{ visibility: visible !important; content: "' + before + '" !important; }\n'; }
					if(after != '') { textCSS += '	#' + tileId + ' .tile-' + textPos.toLowerCase() + ':after { visibility: visible !important; content: "' + after + '" !important; }\n'; }
				}
			}
		}
	}
	
	//Fonts and Text Styling
	
	var adjustFontSize		= document.getElementById(srcTileId + '_text' + textPos + 'FontSize').checked;
	var fontSizeVal			= document.getElementById(srcTileId + '_text' + textPos + 'FontSizeVal').value;
	
	var adjustFontFamily	= document.getElementById(srcTileId + '_text' + textPos + 'FontFamily').checked;
	var vFontFamilyVal		= document.getElementById(srcTileId + '_text' + textPos + 'FontFamilyVal').value;
	var vFontFamilyOther	= document.getElementById(srcTileId + '_text' + textPos + 'FontFamilyOther').value;
	var vFontFamilyUsed		= (vFontFamilyOther != '') ? vFontFamilyOther : vFontFamilyVal;
	
	var vFontBold			= document.getElementById(srcTileId + '_text' + textPos + 'FontBold').checked;
	var vFontItalic			= document.getElementById(srcTileId + '_text' + textPos + 'FontItalic').checked;
	var vFontUnderline		= document.getElementById(srcTileId + '_text' + textPos + 'FontUnderline').checked;
	
	var vFontColor			= document.getElementById(srcTileId + '_text' + textPos + 'FontColor').checked;
	var vFontColorVal	= document.getElementById(srcTileId + '_text' + textPos + 'FontColorVal').value;
	var vFontColorAlpha	= document.getElementById(srcTileId + '_text' + textPos + 'FontColorAlpha').value;
	var colorString = 'rgba(' + hexToRgb(vFontColorVal.replace("#","")) + ',' + vFontColorAlpha + ')';
	
	var adjustAlignment = document.getElementById(srcTileId + '_text' + textPos + 'Align').checked;
	var alignVal = document.getElementById(srcTileId + '_text' + textPos + 'AlignVal').value;
	
	if (adjustFontFamily || adjustFontSize || vFontBold || vFontItalic || vFontUnderline || vFontColor) {
		if (textPos != 'TextTile') { textCSS += '	#' + tileId + ' .tile-' + textPos.toLowerCase() + ' {\n'; }
		else { textCSS += '	#' + tileId + ' div>div ' + ' {\n'; }
		
		var settings = '';
		if (adjustFontFamily) { settings += '		font-family: \'' + vFontFamilyUsed + '\' !important;\n'; }
		if (adjustFontSize) { settings += '		font-size: ' + fontSizeVal + 'px !important;\n'; }
		if (vFontBold) { settings += '		font-weight: bold !important;\n'; }
		if (vFontItalic) { settings += '		font-style: italic !important;\n'; }
		if (vFontUnderline) { settings += '		text-decoration: underline !important;\n'; }
		if (vFontColor) { settings += '		color: ' + colorString + ' !important;\n'; }
		
		if (adjustAlignment) {
			if (textPos != 'TextTile') { settings += '		text-align: ' + alignVal + ' !important;\n'; }
			else { settings += '		justify-content: ' + alignVal + ' !important;\n'; }
		}
		
		textCSS += settings + '	}\n';
	}
	
	return textCSS;
}

function writeCSS() {

var dashName = getDashName();
var url = "http://" + location.hostname + ":8080/hub/fileManager/upload";

var xhr = new XMLHttpRequest();
xhr.open("POST", url);

xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary=----WebKitFormBoundaryDtoO2QfPwfhTjOuS");

xhr.onreadystatechange = function () {
   if (xhr.readyState === 4) {
      console.log(xhr.responseText);
   }};

var data = '------WebKitFormBoundaryDtoO2QfPwfhTjOuS\n';
data += 'Content-Disposition: form-data; name="uploadFile"; filename="' + dashName + '.css"\n';
data += 'Content-Type: text/plain\n\n';

data += '/* *********  Dashboard Settings  ********* */\n';

var dashHeader = document.querySelector('input[name="dashHeader"]:checked')?.value;
var hideDashBack = document.getElementById('hideDashBack');
var hideDashTitle = document.getElementById('hideDashTitle');
	
if (dashHeader == 'hidden') { 
	data += '	.wrapper { height: 100%; margin-top: 0; padding-top: 0; } \n';
	data += '	.dashboard div .header>.flex-auto.justify-end, .dashboard div .header>.flex-auto.justify-end>.flex { visibility: hidden; display: none; }\n';
}

else {

	if (dashHeader == 'Normal') {
		if (hideDashBack.checked) { data += '	.dashBack { display: none; } \n'; }
		if (hideDashTitle.checked) { data += '	.dashName { display: none; } \n'; }
	}
	else {

		if (dashHeader == 'TopRight') {

			data += '	.dashboard div .header { position: fixed; top: 0; right: 1em; z-index: 999; opacity: .2; zoom: .6; -moz-transform:scale(.6); }\n';
			data += '	.dashboard div .header>.flex-auto.justify-end, .dashboard div .header>.flex-auto.justify-end>.flex { display: block; }\n';
		}
		if (dashHeader == 'BottomRight') {

			data += '	.dashboard div .header { position: fixed; bottom: 0; right: 1em; z-index: 999; opacity: .2; zoom: .6; -moz-transform:scale(.6); }\n';
			data += '	.dashboard div .header>.flex-auto.justify-end, .dashboard div .header>.flex-auto.justify-end>.flex { display: block; }\n';
		}
		if (dashHeader == 'TopLeft') {

			data += '	.dashboard div .header { position: fixed; top: 0; left: 1em; z-index: 999; opacity: .2; zoom: .6; -moz-transform:scale(.6); }\n';
			data += '	.dashboard div .header>.flex-auto.justify-end, .dashboard div .header>.flex-auto.justify-end>.flex { display: block; }\n';
		}
		if (dashHeader == 'BottomLeft') {

			data += '	.dashboard div .header { position: fixed; bottom: 0; left: 1em; z-index: 999; opacity: .2; zoom: .6; -moz-transform:scale(.6); }\n';
			data += '	.dashboard div .header>.flex-auto.justify-end, .dashboard div .header>.flex-auto.justify-end>.flex { display: block; }\n';
		}
		
		data += '	.dashBack { display: none; } \n';
		data += '	.dashName { display: none; } \n';
	}

}

	data += '\n\n/* *********  Tile Settings   *********  */\n';

	var x = window.parent.document.getElementsByClassName("tile");
	var i;
	// For Each Tile in the dashboard
	for (i = 0; i < x.length; i++) {
		var tileId = x[i].id;
		var cssTemp = document.getElementById(tileId + '_CSSTemplate').value;
		var srcTileId = (cssTemp != 'default' && cssTemp != '') ? cssTemp : tileId;
		var exportCSS = document.getElementById(tileId + '_exportCSS');
		if (exportCSS.checked) {
			data += '\n\n/* ' + tileId + ' Settings */\n';
			var hideTitle = document.getElementById(srcTileId + '_hideTitle');
			if(hideTitle.checked) {
			  data += '	#' + tileId + ' .tile-title { visibility: hidden; display: none; }\n';
			}
		
			var zIndex = document.getElementById(srcTileId + '_z-index');
			if(zIndex.value != "") {
			  data += '	#' + tileId + ' { z-index: ' + zIndex.value + '; !important; }\n';
			}
		
			// Borders
			var borderRadius = document.getElementById(`${srcTileId}_radius`);
			if(borderRadius.value != "") {
			  data += '	#' + tileId + ' { border-radius: ' + borderRadius.value + 'px !important; }\n';
			}
		
			if (document.getElementById(`${srcTileId}_borderAll`).checked) { data += getTileBorderCSS(tileId, srcTileId, 'All') + '\n'; }
			else {
			
				if (document.getElementById(`${srcTileId}_borderLeft`).checked)		{ data += getTileBorderCSS(tileId, srcTileId, 'Left'); }
				if (document.getElementById(`${srcTileId}_borderRight`).checked)	{ data += getTileBorderCSS(tileId, srcTileId, 'Right'); }
				if (document.getElementById(`${srcTileId}_borderTop`).checked) 		{ data += getTileBorderCSS(tileId, srcTileId, 'Top'); }
				if (document.getElementById(`${srcTileId}_borderBottom`).checked)	{ data += getTileBorderCSS(tileId, srcTileId, 'Bottom'); }
			}
			
			// Text
			if (document.getElementById(srcTileId + '_textTitle').checked)		{ data += getTileTextCSS(tileId, srcTileId, 'Title'); }
			if (document.getElementById(srcTileId + '_textPrimary').checked)	{ data += getTileTextCSS(tileId, srcTileId, 'Primary'); }
			if (document.getElementById(srcTileId + '_textSecondary').checked)	{ data += getTileTextCSS(tileId, srcTileId, 'Secondary'); }
			if (document.getElementById(srcTileId + '_textTertiary').checked)	{ data += getTileTextCSS(tileId, srcTileId, 'Tertiary'); }
			if (document.getElementById(srcTileId + '_textTextTile').checked)	{ data += getTileTextCSS(tileId, srcTileId, 'TextTile'); }
			
			// Icons and Controls
			if (document.getElementById(srcTileId + '_iconsIconHide').checked)		{ data += '	#' + tileId + ' .material-icons { display: none; !important; }\n'; }
			if (document.getElementById(srcTileId + '_iconsDimmerHide').checked)	{ data += '	#' + tileId + ' .tile-primary > div.dimmer { display: none; !important; }\n'; }
			
			// General Tile Settings
			var bgColor = document.getElementById(srcTileId + '_bg-color');
			var bgAlpha = document.getElementById(srcTileId + '_bg-alpha');
			if(bgColor.value != "#000000") {
			  if(bgAlpha.value != "" && bgAlpha.value != "1") {
				data += `	#${tileId} { background-color: rgba(${hexToRgb(bgColor.value.replace('#',''))},${bgAlpha.value}) !important; }
`;
			  }
			  else {
				data += `	#${tileId} { background-color: rgb(${hexToRgb(bgColor.value.replace('#',''))}) !important; }
`;
			  }
			}
		}
	}


	data = data + ` 

------WebKitFormBoundaryDtoO2QfPwfhTjOuS
Content-Disposition: form-data; name="folder"


------WebKitFormBoundaryDtoO2QfPwfhTjOuS--`;

	xhr.send(data);

	writeSettings();

} //end of writeCSS()



function getTileBorderJSON(tileId, borderPos) {

	var thick		= document.getElementById(tileId + '_border' + borderPos + 'Thick');
	var thickOth	= document.getElementById(tileId + '_border' + borderPos + 'ThickOth');
	var style		= document.getElementById(tileId + '_border' + borderPos + 'Style');
	var color		= document.getElementById(tileId + '_border' + borderPos + 'Color');
	var colorAlpha	= document.getElementById(tileId + '_border' + borderPos + 'ColorAlpha');
	//var rgbaColorVal = hexToRgb(color.value.replace("#","")) + ',' + colorAlpha.value;
	return JSON.stringify({ thick : thick.value , thickOth : thickOth.value , style : style.value, color : color.value, colorAlpha : colorAlpha.value });
}

function getTileTextJSON(tileId, textType) {

	var textContentsHide	= (document.getElementById(tileId + '_text' + textType + 'Hide')?.checked) ? true : false;
	var textContentsReplace = (document.getElementById(tileId + '_text' + textType + 'Replace')?.checked) ? true : false;
	var textContentsAddTo	= (document.getElementById(tileId + '_text' + textType + 'AddTo')?.checked) ? true : false;
	
	var replaceTextVal	= document.getElementById(tileId + '_text' + textType + 'ReplaceText').value;
	var beforeTextVal	= document.getElementById(tileId + '_text' + textType + 'BeforeText').value;
	var afterTextVal	= document.getElementById(tileId + '_text' + textType + 'AfterText').value;
	
	var adjustFontSize	= (document.getElementById(tileId + '_text' + textType + 'FontSize')?.checked) ? true : false;
	var vfontSizeVal	= document.getElementById(tileId + '_text' + textType + 'FontSizeVal').value;
	
	var adjustFontFamily	= document.getElementById(tileId + '_text' + textType + 'FontFamily').checked;
	var vFontFamilyVal		= document.getElementById(tileId + '_text' + textType + 'FontFamilyVal').value;
	var vFontFamilyOther	= document.getElementById(tileId + '_text' + textType + 'FontFamilyOther').value;
	
	var vFontBold			= document.getElementById(tileId + '_text' + textType + 'FontBold').checked;
	var vFontItalic			= document.getElementById(tileId + '_text' + textType + 'FontItalic').checked;
	var vFontUnderline		= document.getElementById(tileId + '_text' + textType + 'FontUnderline').checked;
	
	var vFontColor			= document.getElementById(tileId + '_text' + textType + 'FontColor').checked;
	var vFontColorVal	= document.getElementById(tileId + '_text' + textType + 'FontColorVal').value;
	var vFontColorAlpha	= document.getElementById(tileId + '_text' + textType + 'FontColorAlpha').value;
	
	var adjustAlignment = document.getElementById(tileId + '_text' + textType + 'Align').checked;
	var alignVal = document.getElementById(tileId + '_text' + textType + 'AlignVal').value;
	
	return JSON.stringify({ hide : textContentsHide , replace : textContentsReplace , addTo : textContentsAddTo , replaceText : replaceTextVal, beforeText : beforeTextVal , afterText : afterTextVal , fontSize : adjustFontSize , fontSizeVal : vfontSizeVal , fontFamily : adjustFontFamily , fontFamilyVal : vFontFamilyVal , fontFamilyOther : vFontFamilyOther , fontBold : vFontBold , fontItalic : vFontItalic , fontUnderline : vFontUnderline , align : adjustAlignment , alignVal : alignVal , fontColor : vFontColor , fontColorVal : vFontColorVal , fontColorAlpha : vFontColorAlpha });
}

function writeSettings() {

var dashName = getDashName();
var url = "http://" + location.hostname + ":8080/hub/fileManager/upload";

var xhr = new XMLHttpRequest();
xhr.open("POST", url);

xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary=----WebKitFormBoundaryDtoO2QfPwfhTjOuS");

xhr.onreadystatechange = function () {
   if (xhr.readyState === 4) {
      console.log(xhr.responseText);
   }};

var data = '------WebKitFormBoundaryDtoO2QfPwfhTjOuS\n';
data += 'Content-Disposition: form-data; name="uploadFile"; filename="' + dashName + '.json"\n';
data += 'Content-Type: text/plain\n\n';


var dashHeader = document.querySelector('input[name="dashHeader"]:checked')?.value;
var hideDashBack = (document.getElementById('hideDashBack').checked) ? true : false;
var hideDashTitle = (document.getElementById('hideDashTitle').checked) ? true : false;

data += '{';

data += ' "dashboard" : { "dashHeader" : "' + dashHeader + '"\n';
data += '				, "hideDashBack" : ' + hideDashBack + '\n';
data += '				, "hideDashTitle" : ' + hideDashTitle + '\n';
data += '		}\n';


var x = window.parent.document.getElementsByClassName("tile");
var i;

data += ',"tiles" : [\n';

// For Each Tile in the dashboard
for (i = 0; i < x.length; i++) {
	
	var id = "${x[i].id}";
	var nameEl = document.getElementById(x[i].id + '_name');
	var groupEl = document.getElementById(x[i].id + '_group');
	var notesEl = document.getElementById(x[i].id + '_notes');
	var exportCSSEl = document.getElementById(x[i].id + '_exportCSS');
	var hideTitleEl = document.getElementById(x[i].id + '_hideTitle');
	var borderRadiusEl = document.getElementById(x[i].id + '_radius');
	var zIndexEl = document.getElementById(x[i].id + '_z-index');
	var bgColorEl = document.getElementById(x[i].id + '_bg-color');
	var bgAlphaEl = document.getElementById(x[i].id + '_bg-alpha');
	var rgbaColorVal = hexToRgb(bgColorEl.value.replace("#","")) + ',' + bgAlphaEl.value;
	var cssTemplate = document.getElementById(x[i].id + '_CSSTemplate').value;
	
	var borderJson = '{ ';
	
	if (document.getElementById(`${x[i].id}_borderAll`).checked) { borderJson += '\n				"All": ' + getTileBorderJSON(x[i].id, 'All'); }
	else {
	
		if (document.getElementById(`${x[i].id}_borderLeft`).checked)	{ if (borderJson != '{ ') { borderJson += ','; }
																		  borderJson += '\n				"Left": ' + getTileBorderJSON(x[i].id, 'Left') + '\n';
																		}
		if (document.getElementById(`${x[i].id}_borderRight`).checked)	{ if (borderJson != '{ ') { borderJson += ','; }
																		  borderJson += '\n				"Right": ' + getTileBorderJSON(x[i].id, 'Right') + '\n';
																		}
		if (document.getElementById(`${x[i].id}_borderTop`).checked) 	{ if (borderJson != '{ ') { borderJson += ','; }
																		  borderJson += '\n				"Top": ' + getTileBorderJSON(x[i].id, 'Top') + '\n';
																		}
		if (document.getElementById(`${x[i].id}_borderBottom`).checked)	{ if (borderJson != '{ ') { borderJson += ','; }
																		  borderJson += '\n				"Bottom": ' + getTileBorderJSON(x[i].id, 'Bottom') + '\n';
																		}
	}
	borderJson += '		}';
	
	
	// Text Title
		
	var textJson = '{ ';
	if (document.getElementById(x[i].id + '_textTitle').checked) { textJson += '\n				"Title": ' + getTileTextJSON(x[i].id, 'Title'); }
	if (document.getElementById(x[i].id + '_textPrimary').checked) { if (textJson != '{ ') { textJson += ','; }
																	 textJson += '\n				"Primary": ' + getTileTextJSON(x[i].id, 'Primary');
																	}
	if (document.getElementById(x[i].id + '_textSecondary').checked) {
																		if (textJson != '{ ') { textJson += ','; }
																		textJson += '\n				"Secondary": ' + getTileTextJSON(x[i].id, 'Secondary');
																	}
	if (document.getElementById(x[i].id + '_textTertiary').checked) {
																		if (textJson != '{ ') { textJson += ','; }
																		textJson += '\n				"Tertiary": ' + getTileTextJSON(x[i].id, 'Tertiary');
																	}
	if (document.getElementById(x[i].id + '_textTextTile').checked) {
																		if (textJson != '{ ') { textJson += ','; }
																		textJson += '\n				"TextTile": ' + getTileTextJSON(x[i].id, 'TextTile');
																	}
	textJson += '\n			}';

	var iconHide	= document.getElementById(x[i].id + '_iconsIconHide').checked
	var dimmerHide	= document.getElementById(x[i].id + '_iconsDimmerHide').checked
	
	var iconsJson = '{ ';
	iconsJson += '"iconHide" : ' + iconHide + ', "dimmerHide" : ' + dimmerHide;
	
	iconsJson += ' }';
	
	data += '	{ ';
	data += '"id" : "' + x[i].id + '", "name" : "' + nameEl.value + '", "group" : "' + groupEl.value + '", "notes" : "' + notesEl.value + '", "exportCSS" : ' + exportCSSEl.checked + ', "cssTemplate" : "' + cssTemplate + '", "hideTitle" : ' + hideTitleEl.checked + ', "borderRadius" : "' + borderRadiusEl.value + '",\n		"borders" : ' + borderJson + ',\n		"text" : ' + textJson + ',\n		"icons" : ' + iconsJson + '\n		,"zIndex" : "' + zIndexEl.value + '", "bgColor" : "' + rgbaColorVal + '"\n	}';
	
	if( i < (x.length - 1) ) { data += ',\n' }

	  }
data += '\n  ]\n}\n';

data = data + `

------WebKitFormBoundaryDtoO2QfPwfhTjOuS
Content-Disposition: form-data; name="folder"


------WebKitFormBoundaryDtoO2QfPwfhTjOuS--`;

xhr.send(data);

} // end of writeSettings()





</script>

<script>
function expandSetting(button, tileId, setting, iconToggle) {
    
	if (iconToggle == "yes") {
		button.classList.toggle("active");
	}
    var content = document.getElementById(tileId + '_' + setting + 'Content');
	
	if (content.style.maxHeight){
      content.style.maxHeight = null;
    } else {
		content.style.maxHeight = "5000px";
      //if (setting == 'tile') { content.style.maxHeight = "5000px"; }
	  //else { content.style.maxHeight = content.scrollHeight + "px"; }
    }
  }
</script>

</html>